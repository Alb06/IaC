# Nettoyage des ressources temporaires (mis Ã  jour)
cleanup:
  stage: cleanup
  image: alpine:latest
  timeout: 3m
  script:
    - echo "ðŸ§¹ Nettoyage des ressources temporaires..."
    - |
      # Nettoyage des anciens plans
      find ${TF_ROOT} -name "tfplan" -mtime +7 -delete || true
      find ${TF_ROOT} -name "*.backup.*" -mtime +30 -delete || true
      
      # ðŸ†• Nettoyage des anciens rapports de validation
      find . -name "version_validation_report.json" -mtime +7 -delete || true
      find ${TF_ROOT} -name "version-constraints.json" -mtime +30 -delete || true
      
      # Nettoyage des logs
      find /tmp -name "*.log" -mtime +1 -delete || true
      
      echo "âœ… Nettoyage terminÃ© (incluant fichiers de versions)"
  
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      when: manual
  # tags:
  #   - terraform